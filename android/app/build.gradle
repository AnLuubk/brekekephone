apply plugin: "com.android.application"

import com.android.build.OutputFile

project.ext.react = [
  entryFile: "index.js"
]
apply from: "../../node_modules/react-native/react.gradle"

def enableSeparateBuildPerCPUArchitecture = false
def enableProguardInReleaseBuilds = false

android {
  compileSdkVersion rootProject.ext.compileSdkVersion
  compileOptions {
    sourceCompatibility JavaVersion.VERSION_1_8
    targetCompatibility JavaVersion.VERSION_1_8
  }
  signingConfigs {
    development {
      storeFile file(DEV_STORE_FILE)
      keyAlias DEV_KEY_ALIAS
      storePassword DEV_STORE_PASSWORD
      keyPassword DEV_KEY_PASSWORD
    }
    release {
      storeFile file(RELEASE_STORE_FILE)
      keyAlias RELEASE_KEY_ALIAS
      storePassword RELEASE_STORE_PASSWORD
      keyPassword RELEASE_KEY_PASSWORD
    }
  }
  //
  defaultConfig {
    applicationId "com.brekeke.phone"
    versionCode 30001
    versionName "3.0.0"
    targetSdkVersion rootProject.ext.targetSdkVersion
    ndk {
      abiFilters "armeabi-v7a", "x86"
    }
    signingConfig signingConfigs.development
  }
  //
  splits {
    abi {
      reset()
      enable enableSeparateBuildPerCPUArchitecture
      universalApk false // If true, also generate a universal APK
      include "armeabi-v7a", "x86"
    }
  }
  buildTypes {
    release {
      minifyEnabled enableProguardInReleaseBuilds
      proguardFiles getDefaultProguardFile("proguard-android.txt"), "proguard-rules.pro"
      signingConfig signingConfigs.release
      // debuggable true
    }
  }
  applicationVariants.all { variant ->
    variant.outputs.each { output ->
      // http://tools.android.com/tech-docs/new-build-system/user-guide/apk-splits
      def versionCodes = ["armeabi-v7a": 1, "x86": 2]
      def abi = output.getFilter(OutputFile.ABI)
      if (abi != null) {
        output.versionCodeOverride = versionCodes.get(abi) * 1048576 + defaultConfig.versionCode
      }
    }
  }
}

dependencies {
  compile fileTree(include: ["*.jar"], dir: "libs")
  compile "com.android.support:appcompat-v7:${rootProject.ext.supportLibVersion}"
  compile "com.facebook.react:react-native:+"
  // https://github.com/evollu/react-native-fcm/issues/1111
  compile "com.google.firebase:firebase-core:16.0.3"
  compile "com.google.firebase:firebase-messaging:17.6.0"
  //
  compile (project(":react-native-camera")) {
    exclude group: "com.google.android.gms"
    exclude group: "com.android.support"
    compile "com.android.support:exifinterface:28.+"
    compile ("com.google.android.gms:play-services-vision:12.0.1") {
      force = true
    }
  }
  compile project(":@react-native-community_async-storage")
  compile project(":react-native-document-picker")
  compile project(":react-native-exception-handler")
  compile project(":react-native-fcm")
  compile project(":react-native-fs")
  compile project(":react-native-incall-manager")
  compile project(":react-native-keep-awake")
  compile project(":react-native-loud-speaker")
  compile project(":react-native-splash-screen")
  compile project(":react-native-video")
  compile project(":react-native-webrtc")
}

// Run this once to be able to run the application with BUCK
// puts all compile dependencies into folder libs for BUCK to use
task copyDownloadableDepsToLibs(type: Copy) {
  from configurations.compile
  into "libs"
}

apply plugin: "com.google.gms.google-services"
